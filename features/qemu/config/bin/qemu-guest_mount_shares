#! /usr/bin/env bash

set -e
set -u


# =============================================================================
# Configuration
# =============================================================================

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
# Source common variables and functions
source "$SCRIPT_DIR/qemu-common_config"


# =============================================================================
# Execution
# =============================================================================

## Define a list of shared folders to mount
VM_SHARES=(
  "share"
  "software"
  "shell"
)

# Process each shared folder
for VM_SHARE in "${VM_SHARES[@]}"; do
    VM_SHARE_PATH="${HOME}/${VM_SHARE}"
    sudo umount ${VM_SHARE_PATH} 2>/dev/null || true
    mkdir -p ${VM_SHARE_PATH}

    sudo mount -v -t 9p -o trans=virtio,version=9p2000.L ${VM_SHARE} ${VM_SHARE_PATH}
done


echo ""
echo "To make it permanent, add these lines to /etc/fstab:"
for VM_SHARE in "${VM_SHARES[@]}"; do
    echo "${VM_SHARE}  ${HOME}/${VM_SHARE}  9p trans=virtio,version=9p2000.L,defaults  0  0"
done
echo ""

