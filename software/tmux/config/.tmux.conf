# : << 'EOF'
# My tmux configuration. Based on the default one, with some tweaks and plugins.

# -- general -------------------------------------------------------------------

# color. Run tmux/tic-install.sh to make italic working
set -g default-terminal "screen-256color"

# extended keys for Control + Shift bindings. This is needed for tmux 3.2+ to work properly with iTerm2 and mintty, which are the terminals I use on Mac and Windows respectively. If extended keys are not enabled, Control + Shift bindings will not work in those terminals.
%if #{>=:#{version},3.2}
set -g extended-keys #{?#{||:#{m/ri:mintty|iTerm,#{TERM_PROGRAM}},#{!=:#{XTERM_VERSION},}},on,off} # needed by Control + Shift bindings
%endif

# Allows for faster key repetition
set -s escape-time 10                     # faster command sequences
set -sg repeat-time 600                   # increase repeat timeout

# Focus events. This is needed for tmux to properly detect when the terminal window is focused or not, which can be useful for some plugins and scripts that want to change their behavior based on focus.
set -s focus-events on

# boost history
set -g history-limit 5000

# UTF-8 settings. This is needed for tmux to properly display UTF-8 characters, which can be useful for some plugins and scripts that want to use UTF-8 characters in their output.
set -q -g status-utf8 on                  # expect UTF-8 (tmux < 2.2)
setw -q -g utf8 on

# C-b is not acceptable -- Vim uses it
set-option -g prefix C-a
bind-key C-a last-window

# Allows us to use C-a a <command> to send commands to a TMUX session inside another TMUX session
bind-key a send-prefix

# -- display -------------------------------------------------------------------

set -g base-index 1           # start windows numbering at 1
setw -g pane-base-index 1     # make pane numbering consistent with windows

# auto window rename
set-window-option -g automatic-rename
setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed

# TODO check compatibility with Linux
# # set terminal title
# set -g set-titles on
# set -g set-titles-string '#W'

# make pane borders and status bar more visible
set -g display-panes-time 800 # slightly longer pane indicators display time
set -g display-time 1000      # slightly longer status messages display time

# status settings
set -g status-interval 10 # redraw status line every 10 seconds
set -g status-left '[C-a][#S] >'

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on

# Rather than constraining window size to the maximum size of any client 
# connected to the *session*, constrain window size to the maximum size of any 
# client connected to *that window*. Much more reasonable.
#
# Currently, it's off to accomodate the iterm2-tmux integration
setw -g aggressive-resize off

# -- clipboard -----------------------------------------------------------------

# Vi copypaste mode
set-window-option -g mode-keys vi
# The next lines needs to be fixed since I get this error:
# /Users/fsferrara/.tmux.conf:44: usage: bind-key [-cnr] [-T key-table] key command [arguments]
bind-key -Tcopy-mode-vi 'v' send -X begin-selection
bind-key -Tcopy-mode-vi 'y' send -X copy-selection

# -- navigation ----------------------------------------------------------------

# create session
bind C-c new-session

# if run as "tmux attach", create a session if one does not already exist
new-session -n $HOST

# set window split
bind-key v split-window -h
bind-key b split-window

# pane navigation
bind -r h select-pane -L  # move left
bind -r j select-pane -D  # move down
bind -r k select-pane -U  # move up
bind -r l select-pane -R  # move right

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# swap panes
bind > swap-pane -D       # swap current pane with the next one
bind < swap-pane -U       # swap current pane with the previous one

bind-key C command-prompt -p "Name of new window: " "new-window -n '%%'"

# reload config
bind r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded..."

# mouse mode on
set-option -g mouse on

# make scrolling with wheels work
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M



# Updates for tmux 1.9's current pane splitting paths.
if-shell "[[ `tmux -V` == *1.9* ]]" 'unbind c; bind c new-window -c "#{pane_current_path}"'
if-shell "[[ `tmux -V` == *1.9* ]]" 'unbind s; bind s split-window -v -c "#{pane_current_path}"'
if-shell "[[ `tmux -V` == *1.9* ]]" "unbind '\"'; bind '\"' split-window -v -c '#{pane_current_path}'"
if-shell "[[ `tmux -V` == *1.9* ]]" 'unbind v; bind v split-window -h -c "#{pane_current_path}"'
if-shell "[[ `tmux -V` == *1.9* ]]" 'unbind %; bind % split-window -h -c "#{pane_current_path}"'

# -- theming -------------------------------------------------------------------


# default theme
tmux_conf_theme_colour_1="#080808"    # dark gray
tmux_conf_theme_colour_2="#303030"    # gray
tmux_conf_theme_colour_3="#8a8a8a"    # light gray
tmux_conf_theme_colour_4="#00afff"    # light blue
tmux_conf_theme_colour_5="#ffff00"    # yellow
tmux_conf_theme_colour_6="#080808"    # dark gray
tmux_conf_theme_colour_7="#e4e4e4"    # white
tmux_conf_theme_colour_8="#080808"    # dark gray
tmux_conf_theme_colour_9="#ffff00"    # yellow
tmux_conf_theme_colour_10="#ff00af"   # pink
tmux_conf_theme_colour_11="#5fff00"   # green
tmux_conf_theme_colour_12="#8a8a8a"   # light gray
tmux_conf_theme_colour_13="#e4e4e4"   # white
tmux_conf_theme_colour_14="#080808"   # dark gray
tmux_conf_theme_colour_15="#080808"   # dark gray
tmux_conf_theme_colour_16="#d70000"   # red
tmux_conf_theme_colour_17="#e4e4e4"   # white

# -- plugins -------------------------------------------------------------------

# First, install tmp...
set -g @plugin 'tmux-plugins/tpm'

# ...then the other plugins:
set -g @plugin 'tmux-plugins/tmux-sensible'
#set -g @plugin 'tmux-plugins/tmux-resurrect'
#set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
